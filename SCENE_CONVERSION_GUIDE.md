# Scene and Prefab Conversion Guide

## Important Notice

⚠️ **Scene (.fire) and Prefab (.prefab) files CANNOT be automatically converted via code changes.**

The file format for Cocos Creator 3.x is fundamentally different from 2.x. These files must be opened and converted using the **Cocos Creator 3.8.6 Editor**.

## Why Manual Conversion is Required

Cocos Creator 2.x scene format:
- Uses `cc.SceneAsset`, `cc.Node`, `cc.Component` serialization format
- Different property structures
- Legacy component references

Cocos Creator 3.x scene format:
- Uses completely different serialization system
- New component architecture
- Different node hierarchy structure
- Updated property formats

## Conversion Steps

### 1. Install Cocos Creator 3.8.6 Editor

Download from: https://www.cocos.com/creator-download

### 2. Open Project in Editor

1. Launch Cocos Creator 3.8.6
2. Open the project directory
3. The editor will detect version mismatch

### 3. Automatic Conversion Process

The editor will:
- Detect v2.x format files
- Prompt for automatic upgrade
- Convert scene and prefab files
- Update meta files
- Migrate component references

### 4. Manual Verification Required

After automatic conversion:

#### Scenes to Verify:
- `assets/Scene/Login.fire` - Login scene
- `assets/Scene/Game.fire` - Main game scene

#### Prefabs to Verify:
- `assets/Prefabs/BombWhite.prefab`
- `assets/Prefabs/Fox.prefab`
- `assets/Prefabs/Crush.prefab`
- `assets/Prefabs/Bird.prefab`
- `assets/Prefabs/Cat.prefab`
- `assets/Prefabs/Horse.prefab`
- `assets/Prefabs/Bear.prefab`
- `assets/Prefabs/Frog.prefab`
- `assets/Prefabs/Chicken.prefab`

#### Verification Checklist:
- [ ] All nodes are properly converted
- [ ] Component scripts are correctly assigned (.ts files)
- [ ] Properties are properly mapped
- [ ] Animations are intact
- [ ] Prefab references work correctly
- [ ] Audio clips are assigned
- [ ] Sprite references are correct

### 5. Update Script References

After conversion, verify that all script components reference the new `.ts` files:

**Old (v2.x):**
- `GameController.js`
- `LoginController.js`
- `CellView.js`
- `GridView.js`
- `EffectLayer.js`
- `AudioUtils.js`

**New (v3.x):**
- `GameController.ts`
- `LoginController.ts`
- `CellView.ts`
- `GridView.ts`
- `EffectLayer.ts`
- `AudioUtils.ts`

The editor should automatically update these references during conversion.

### 6. Test in Editor

Before building:
1. Open each scene
2. Press Play in editor
3. Test all game functionality
4. Check console for errors
5. Verify animations play correctly
6. Test audio playback

### 7. Common Issues

**Issue: Script component missing**
- Solution: Manually reassign the TypeScript script in inspector

**Issue: Property values lost**
- Solution: Manually reconfigure properties in inspector

**Issue: Prefab connection broken**
- Solution: Re-link prefab in scene hierarchy

**Issue: Animation targets missing**
- Solution: Re-target animations to correct nodes

## Current Status

✅ **Code Migration Complete:**
- All TypeScript files ready
- All APIs updated to v3.x
- Type safety implemented

⚠️ **Requires Editor Action:**
- Scene files in v2.x format
- Prefab files in v2.x format
- Meta files need regeneration

## Technical Details

### File Format Differences

**v2.x Scene Structure:**
```json
{
  "__type__": "cc.SceneAsset",
  "scene": {
    "__type__": "cc.Scene",
    "_children": [...],
    "_components": [...]
  }
}
```

**v3.x Scene Structure:**
```json
[
  {
    "__type__": "cc.SceneAsset",
    "_name": "scene",
    "_objFlags": 0,
    "scene": {"__id__": 1}
  },
  {
    "__type__": "cc.Scene",
    "_name": "scene",
    "_objFlags": 0,
    "_parent": null,
    "autoReleaseAssets": false,
    ...
  }
]
```

### Meta File Format

Meta files will also be regenerated by the editor with v3.x format:

**v2.x:**
```json
{
  "ver": "1.2.9",
  "uuid": "...",
  "asyncLoadAssets": false
}
```

**v3.x:**
```json
{
  "ver": "4.0.23",
  "importer": "scene",
  "imported": true,
  "uuid": "..."
}
```

## Next Steps

1. **Do NOT attempt to manually edit .fire or .prefab files**
2. Open project in Cocos Creator 3.8.6 Editor
3. Allow automatic conversion
4. Verify all scenes and prefabs
5. Test thoroughly in editor
6. Build and test on target platforms

## Support

If conversion issues occur:
- Check Cocos Creator 3.8 migration documentation
- Verify all script files are .ts (not .js)
- Ensure project.json shows version "3.8.6"
- Review editor console for specific errors

For detailed API changes, see [MIGRATION_GUIDE.md](./MIGRATION_GUIDE.md)
