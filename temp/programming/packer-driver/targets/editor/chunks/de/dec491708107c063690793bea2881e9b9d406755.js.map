{"version":3,"sources":["file:///D:/dev/%E6%96%B0%E5%BB%BA%E6%96%87%E4%BB%B6%E5%A4%B9/NewProject/assets/Script/Model/GameModel.ts"],"names":["GameModel","CellModel","mergePointArray","exclusivePoint","CELL_TYPE","CELL_BASENUM","CELL_STATUS","GRID_WIDTH","GRID_HEIGHT","ANITIME","constructor","cells","cellBgs","lastPos","cc","v2","cellTypeNum","cellCreateType","init","setCellTypeNum","i","j","type","flag","getRandomCellType","result","checkPoint","length","setXY","setStartXY","mock","mockInit","A","B","x","y","initWithData","data","recursive","rowResult","checkWithDirection","colResult","samePoints","newCellStatus","BIRD","WRAP","LINE","COLUMN","subCheckPoints","point","subResult","direction","queue","vis","push","front","cellModel","tmpX","tmpY","printInfo","printStr","console","log","getCells","selectCell","pos","changeModels","effectsQueue","delta","Math","abs","curClickCell","lastClickCell","exchangeCell","result1","result2","curTime","pushToChangeModels","isCanBomb","status","COMMON","moveToAndBack","moveTo","TOUCH_MOVE","processCrush","cycleCount","bombModels","pos1","pos2","model1","model2","bombModel","newCellType","crushPoint","model","crushCell","createNewCell","processBomb","DIE","down","setStatus","setVisible","newCheckPoint","curRow","k","count","indexOf","cleanCmd","cmd","tmpModel","num","createTypeList","index","floor","random","newBombModel","bombTime","BOMB_DELAY","forEach","addRowBomb","addColBomb","crushType","BOMB_BIRD_DELAY","addCrushEffect","playTime","step","action","addWrapBomb","needShake","toShake","shakeTime","DIE_SHAKE","toDie"],"mappings":"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","sourcesContent":["import CellModel from \"./CellModel\";\r\nimport { mergePointArray, exclusivePoint } from \"../Utils/ModelUtils\"\r\nimport { CELL_TYPE, CELL_BASENUM, CELL_STATUS, GRID_WIDTH, GRID_HEIGHT, ANITIME } from \"./ConstValue\";\r\n\r\nexport default class GameModel {\r\n  constructor() {\r\n    this.cells = null;\r\n    this.cellBgs = null;\r\n    this.lastPos = cc.v2(-1, -1);\r\n    this.cellTypeNum = 5;\r\n    this.cellCreateType = []; // 升成种类只在这个数组里面查找\r\n  }\r\n\r\n  init(cellTypeNum) {\r\n    this.cells = [];\r\n    this.setCellTypeNum(cellTypeNum || this.cellTypeNum);\r\n    for (var i = 1; i <= GRID_WIDTH; i++) {\r\n      this.cells[i] = [];\r\n      for (var j = 1; j <= GRID_HEIGHT; j++) {\r\n        this.cells[i][j] = new CellModel();\r\n      }\r\n    }\r\n\r\n    // this.mock();\r\n\r\n    for (var i = 1; i <= GRID_WIDTH; i++) {\r\n      for (var j = 1; j <= GRID_HEIGHT; j++) {\r\n        //已经被mock数据生成了\r\n        if (this.cells[i][j].type != null) {\r\n          continue;\r\n        }\r\n        let flag = true;\r\n        while (flag) {\r\n          flag = false;\r\n\r\n          this.cells[i][j].init(this.getRandomCellType());\r\n          let result = this.checkPoint(j, i)[0];\r\n          if (result.length > 2) {\r\n            flag = true;\r\n          }\r\n          this.cells[i][j].setXY(j, i);\r\n          this.cells[i][j].setStartXY(j, i);\r\n        }\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  mock() {\r\n    this.mockInit(5, 1, CELL_TYPE.A);\r\n    this.mockInit(5, 3, CELL_TYPE.A);\r\n    this.mockInit(4, 2, CELL_TYPE.A);\r\n    this.mockInit(3, 2, CELL_TYPE.A);\r\n    this.mockInit(5, 2, CELL_TYPE.B);\r\n    this.mockInit(6, 2, CELL_TYPE.B);\r\n    this.mockInit(7, 3, CELL_TYPE.B);\r\n    this.mockInit(8, 2, CELL_TYPE.A);\r\n  }\r\n  mockInit(x, y, type) {\r\n    this.cells[x][y].init(type)\r\n    this.cells[x][y].setXY(y, x);\r\n    this.cells[x][y].setStartXY(y, x);\r\n  }\r\n\r\n\r\n  initWithData(data) {\r\n    // to do\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param x\r\n   * @param y\r\n   * @param recursive 是否递归查找\r\n   * @returns {([]|string|*)[]}\r\n   */\r\n  checkPoint(x, y, recursive) {\r\n    let rowResult = this.checkWithDirection(x, y, [cc.v2(1, 0), cc.v2(-1, 0)]);\r\n    let colResult = this.checkWithDirection(x, y, [cc.v2(0, -1), cc.v2(0, 1)]);\r\n    let samePoints = [];\r\n    let newCellStatus = \"\";\r\n    if (rowResult.length >= 5 || colResult.length >= 5) {\r\n      newCellStatus = CELL_STATUS.BIRD;\r\n    }\r\n    else if (rowResult.length >= 3 && colResult.length >= 3) {\r\n      newCellStatus = CELL_STATUS.WRAP;\r\n    }\r\n    else if (rowResult.length >= 4) {\r\n      newCellStatus = CELL_STATUS.LINE;\r\n    }\r\n    else if (colResult.length >= 4) {\r\n      newCellStatus = CELL_STATUS.COLUMN;\r\n    }\r\n    if (rowResult.length >= 3) {\r\n      samePoints = rowResult;\r\n    }\r\n    if (colResult.length >= 3) {\r\n      samePoints = mergePointArray(samePoints, colResult);\r\n    }\r\n    let result = [samePoints, newCellStatus, this.cells[y][x].type, cc.v2(x, y)];\r\n    // 检查一下消除的其他节点， 能不能生成更大范围的消除\r\n    if (recursive && result.length >= 3) {\r\n      let subCheckPoints = exclusivePoint(samePoints, cc.v2(x, y));\r\n      for (let point of subCheckPoints) {\r\n        let subResult = this.checkPoint(point.x, point.y, false);\r\n        if (subResult[1] > result[1] || (subResult[1] === result[1] && subResult[0].length > result[0].length)) {\r\n          result = subResult;\r\n        }\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  checkWithDirection(x, y, direction) {\r\n    let queue = [];\r\n    let vis = [];\r\n    vis[x + y * 9] = true;\r\n    queue.push(cc.v2(x, y));\r\n    let front = 0;\r\n    while (front < queue.length) {\r\n      //let direction = [cc.v2(0, -1), cc.v2(0, 1), cc.v2(1, 0), cc.v2(-1, 0)];\r\n      let point = queue[front];\r\n      let cellModel = this.cells[point.y][point.x];\r\n      front++;\r\n      if (!cellModel) {\r\n        continue;\r\n      }\r\n      for (let i = 0; i < direction.length; i++) {\r\n        let tmpX = point.x + direction[i].x;\r\n        let tmpY = point.y + direction[i].y;\r\n        if (tmpX < 1 || tmpX > 9\r\n          || tmpY < 1 || tmpY > 9\r\n          || vis[tmpX + tmpY * 9]\r\n          || !this.cells[tmpY][tmpX]) {\r\n          continue;\r\n        }\r\n        if (cellModel.type === this.cells[tmpY][tmpX].type) {\r\n          vis[tmpX + tmpY * 9] = true;\r\n          queue.push(cc.v2(tmpX, tmpY));\r\n        }\r\n      }\r\n    }\r\n    return queue;\r\n  }\r\n\r\n  printInfo() {\r\n    for (var i = 1; i <= 9; i++) {\r\n      var printStr = \"\";\r\n      for (var j = 1; j <= 9; j++) {\r\n        printStr += this.cells[i][j].type + \" \";\r\n      }\r\n      console.log(printStr);\r\n    }\r\n  }\r\n\r\n  getCells() {\r\n    return this.cells;\r\n  }\r\n  // controller调用的主要入口\r\n  // 点击某个格子\r\n  selectCell(pos) {\r\n    this.changeModels = [];// 发生改变的model，将作为返回值，给view播动作\r\n    this.effectsQueue = []; // 动物消失，爆炸等特效\r\n    var lastPos = this.lastPos;\r\n    var delta = Math.abs(pos.x - lastPos.x) + Math.abs(pos.y - lastPos.y);\r\n    if (delta != 1) { //非相邻格子， 直接返回\r\n      this.lastPos = pos;\r\n      return [[], []];\r\n    }\r\n    let curClickCell = this.cells[pos.y][pos.x]; //当前点击的格子\r\n    let lastClickCell = this.cells[lastPos.y][lastPos.x]; // 上一次点击的格式\r\n    this.exchangeCell(lastPos, pos);\r\n    var result1 = this.checkPoint(pos.x, pos.y)[0];\r\n    var result2 = this.checkPoint(lastPos.x, lastPos.y)[0];\r\n    this.curTime = 0; // 动画播放的当前时间\r\n    this.pushToChangeModels(curClickCell);\r\n    this.pushToChangeModels(lastClickCell);\r\n    let isCanBomb = (curClickCell.status != CELL_STATUS.COMMON && // 判断两个是否是特殊的动物\r\n      lastClickCell.status != CELL_STATUS.COMMON) ||\r\n      curClickCell.status == CELL_STATUS.BIRD ||\r\n      lastClickCell.status == CELL_STATUS.BIRD;\r\n    if (result1.length < 3 && result2.length < 3 && !isCanBomb) {//不会发生消除的情况\r\n      this.exchangeCell(lastPos, pos);\r\n      curClickCell.moveToAndBack(lastPos);\r\n      lastClickCell.moveToAndBack(pos);\r\n      this.lastPos = cc.v2(-1, -1);\r\n      return [this.changeModels];\r\n    }\r\n    else {\r\n      this.lastPos = cc.v2(-1, -1);\r\n      curClickCell.moveTo(lastPos, this.curTime);\r\n      lastClickCell.moveTo(pos, this.curTime);\r\n      var checkPoint = [pos, lastPos];\r\n      this.curTime += ANITIME.TOUCH_MOVE;\r\n      this.processCrush(checkPoint);\r\n      return [this.changeModels, this.effectsQueue];\r\n    }\r\n  }\r\n  // 消除\r\n  processCrush(checkPoint) {\r\n    let cycleCount = 0;\r\n    while (checkPoint.length > 0) {\r\n      let bombModels = [];\r\n      if (cycleCount == 0 && checkPoint.length == 2) { //特殊消除\r\n        let pos1 = checkPoint[0];\r\n        let pos2 = checkPoint[1];\r\n        let model1 = this.cells[pos1.y][pos1.x];\r\n        let model2 = this.cells[pos2.y][pos2.x];\r\n        if (model1.status == CELL_STATUS.BIRD || model2.status == CELL_STATUS.BIRD) {\r\n          let bombModel = null;\r\n          if (model1.status == CELL_STATUS.BIRD) {\r\n            model1.type = model2.type;\r\n            bombModels.push(model1);\r\n          }\r\n          else {\r\n            model2.type = model1.type;\r\n            bombModels.push(model2);\r\n          }\r\n\r\n        }\r\n      }\r\n      for (var i in checkPoint) {\r\n        var pos = checkPoint[i];\r\n        if (!this.cells[pos.y][pos.x]) {\r\n          continue;\r\n        }\r\n        var [result, newCellStatus, newCellType, crushPoint] = this.checkPoint(pos.x, pos.y, true);\r\n\r\n        if (result.length < 3) {\r\n          continue;\r\n        }\r\n        for (var j in result) {\r\n          var model = this.cells[result[j].y][result[j].x];\r\n          this.crushCell(result[j].x, result[j].y, false, cycleCount);\r\n          if (model.status != CELL_STATUS.COMMON) {\r\n            bombModels.push(model);\r\n          }\r\n        }\r\n        this.createNewCell(crushPoint, newCellStatus, newCellType);\r\n\r\n      }\r\n      this.processBomb(bombModels, cycleCount);\r\n      this.curTime += ANITIME.DIE;\r\n      checkPoint = this.down();\r\n      cycleCount++;\r\n    }\r\n  }\r\n\r\n  //生成新cell\r\n  createNewCell(pos, status, type) {\r\n    if (status == \"\") {\r\n      return;\r\n    }\r\n    if (status == CELL_STATUS.BIRD) {\r\n      type = CELL_TYPE.BIRD\r\n    }\r\n    let model = new CellModel();\r\n    this.cells[pos.y][pos.x] = model\r\n    model.init(type);\r\n    model.setStartXY(pos.x, pos.y);\r\n    model.setXY(pos.x, pos.y);\r\n    model.setStatus(status);\r\n    model.setVisible(0, false);\r\n    model.setVisible(this.curTime, true);\r\n    this.changeModels.push(model);\r\n  }\r\n  // 下落\r\n  down() {\r\n    let newCheckPoint = [];\r\n    for (var i = 1; i <= GRID_WIDTH; i++) {\r\n      for (var j = 1; j <= GRID_HEIGHT; j++) {\r\n        if (this.cells[i][j] == null) {\r\n          var curRow = i;\r\n          for (var k = curRow; k <= GRID_HEIGHT; k++) {\r\n            if (this.cells[k][j]) {\r\n              this.pushToChangeModels(this.cells[k][j]);\r\n              newCheckPoint.push(this.cells[k][j]);\r\n              this.cells[curRow][j] = this.cells[k][j];\r\n              this.cells[k][j] = null;\r\n              this.cells[curRow][j].setXY(j, curRow);\r\n              this.cells[curRow][j].moveTo(cc.v2(j, curRow), this.curTime);\r\n              curRow++;\r\n            }\r\n          }\r\n          var count = 1;\r\n          for (var k = curRow; k <= GRID_HEIGHT; k++) {\r\n            this.cells[k][j] = new CellModel();\r\n            this.cells[k][j].init(this.getRandomCellType());\r\n            this.cells[k][j].setStartXY(j, count + GRID_HEIGHT);\r\n            this.cells[k][j].setXY(j, count + GRID_HEIGHT);\r\n            this.cells[k][j].moveTo(cc.v2(j, k), this.curTime);\r\n            count++;\r\n            this.changeModels.push(this.cells[k][j]);\r\n            newCheckPoint.push(this.cells[k][j]);\r\n          }\r\n\r\n        }\r\n      }\r\n    }\r\n    this.curTime += ANITIME.TOUCH_MOVE + 0.3\r\n    return newCheckPoint;\r\n  }\r\n\r\n  pushToChangeModels(model) {\r\n    if (this.changeModels.indexOf(model) != -1) {\r\n      return;\r\n    }\r\n    this.changeModels.push(model);\r\n  }\r\n\r\n  cleanCmd() {\r\n    for (var i = 1; i <= GRID_WIDTH; i++) {\r\n      for (var j = 1; j <= GRID_HEIGHT; j++) {\r\n        if (this.cells[i][j]) {\r\n          this.cells[i][j].cmd = [];\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  exchangeCell(pos1, pos2) {\r\n    var tmpModel = this.cells[pos1.y][pos1.x];\r\n    this.cells[pos1.y][pos1.x] = this.cells[pos2.y][pos2.x];\r\n    this.cells[pos1.y][pos1.x].x = pos1.x;\r\n    this.cells[pos1.y][pos1.x].y = pos1.y;\r\n    this.cells[pos2.y][pos2.x] = tmpModel;\r\n    this.cells[pos2.y][pos2.x].x = pos2.x;\r\n    this.cells[pos2.y][pos2.x].y = pos2.y;\r\n  }\r\n  // 设置种类\r\n  // Todo 改成乱序算法\r\n  setCellTypeNum(num) {\r\n    console.log(\"num = \", num);\r\n    this.cellTypeNum = num;\r\n    this.cellCreateType = [];\r\n    let createTypeList = this.cellCreateType;\r\n    for (let i = 1; i <= CELL_BASENUM; i++) {\r\n      createTypeList.push(i);\r\n    }\r\n    for (let i = 0; i < createTypeList.length; i++) {\r\n      let index = Math.floor(Math.random() * (CELL_BASENUM - i)) + i;\r\n      createTypeList[i], createTypeList[index] = createTypeList[index], createTypeList[i]\r\n    }\r\n  }\r\n  // 随要生成一个类型\r\n  getRandomCellType() {\r\n    var index = Math.floor(Math.random() * this.cellTypeNum);\r\n    return this.cellCreateType[index];\r\n  }\r\n  // TODO bombModels去重\r\n  processBomb(bombModels, cycleCount) {\r\n    while (bombModels.length > 0) {\r\n      let newBombModel = [];\r\n      let bombTime = ANITIME.BOMB_DELAY;\r\n      bombModels.forEach(function (model) {\r\n        if (model.status == CELL_STATUS.LINE) {\r\n          for (let i = 1; i <= GRID_WIDTH; i++) {\r\n            if (this.cells[model.y][i]) {\r\n              if (this.cells[model.y][i].status != CELL_STATUS.COMMON) {\r\n                newBombModel.push(this.cells[model.y][i]);\r\n              }\r\n              this.crushCell(i, model.y, false, cycleCount);\r\n            }\r\n          }\r\n          this.addRowBomb(this.curTime, cc.v2(model.x, model.y));\r\n        }\r\n        else if (model.status == CELL_STATUS.COLUMN) {\r\n          for (let i = 1; i <= GRID_HEIGHT; i++) {\r\n            if (this.cells[i][model.x]) {\r\n              if (this.cells[i][model.x].status != CELL_STATUS.COMMON) {\r\n                newBombModel.push(this.cells[i][model.x]);\r\n              }\r\n              this.crushCell(model.x, i, false, cycleCount);\r\n            }\r\n          }\r\n          this.addColBomb(this.curTime, cc.v2(model.x, model.y));\r\n        }\r\n        else if (model.status == CELL_STATUS.WRAP) {\r\n          let x = model.x;\r\n          let y = model.y;\r\n          for (let i = 1; i <= GRID_HEIGHT; i++) {\r\n            for (let j = 1; j <= GRID_WIDTH; j++) {\r\n              let delta = Math.abs(x - j) + Math.abs(y - i);\r\n              if (this.cells[i][j] && delta <= 2) {\r\n                if (this.cells[i][j].status != CELL_STATUS.COMMON) {\r\n                  newBombModel.push(this.cells[i][j]);\r\n                }\r\n                this.crushCell(j, i, false, cycleCount);\r\n              }\r\n            }\r\n          }\r\n        }\r\n        else if (model.status == CELL_STATUS.BIRD) {\r\n          let crushType = model.type\r\n          if (bombTime < ANITIME.BOMB_BIRD_DELAY) {\r\n            bombTime = ANITIME.BOMB_BIRD_DELAY;\r\n          }\r\n          if (crushType == CELL_TYPE.BIRD) {\r\n            crushType = this.getRandomCellType();\r\n          }\r\n          for (let i = 1; i <= GRID_HEIGHT; i++) {\r\n            for (let j = 1; j <= GRID_WIDTH; j++) {\r\n              if (this.cells[i][j] && this.cells[i][j].type == crushType) {\r\n                if (this.cells[i][j].status != CELL_STATUS.COMMON) {\r\n                  newBombModel.push(this.cells[i][j]);\r\n                }\r\n                this.crushCell(j, i, true, cycleCount);\r\n              }\r\n            }\r\n          }\r\n          //this.crushCell(model.x, model.y);\r\n        }\r\n      }, this);\r\n      if (bombModels.length > 0) {\r\n        this.curTime += bombTime;\r\n      }\r\n      bombModels = newBombModel;\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param {开始播放的时间} playTime \r\n   * @param {*cell位置} pos \r\n   * @param {*第几次消除，用于播放音效} step \r\n   */\r\n  addCrushEffect(playTime, pos, step) {\r\n    this.effectsQueue.push({\r\n      playTime,\r\n      pos,\r\n      action: \"crush\",\r\n      step\r\n    });\r\n  }\r\n\r\n  addRowBomb(playTime, pos) {\r\n    this.effectsQueue.push({\r\n      playTime,\r\n      pos,\r\n      action: \"rowBomb\"\r\n    });\r\n  }\r\n\r\n  addColBomb(playTime, pos) {\r\n    this.effectsQueue.push({\r\n      playTime,\r\n      pos,\r\n      action: \"colBomb\"\r\n    });\r\n  }\r\n\r\n  addWrapBomb(playTime, pos) {\r\n    // TODO\r\n  }\r\n  // cell消除逻辑\r\n  crushCell(x, y, needShake, step) {\r\n    let model = this.cells[y][x];\r\n    this.pushToChangeModels(model);\r\n    if (needShake) {\r\n      model.toShake(this.curTime)\r\n    }\r\n\r\n    let shakeTime = needShake ? ANITIME.DIE_SHAKE : 0;\r\n    model.toDie(this.curTime + shakeTime);\r\n    this.addCrushEffect(this.curTime + shakeTime, cc.v2(model.x, model.y), step);\r\n    this.cells[y][x] = null;\r\n  }\r\n\r\n}\r\n\r\n"]}